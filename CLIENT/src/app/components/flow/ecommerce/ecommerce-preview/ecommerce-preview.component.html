<div class="container py-4 text-light" *ngIf="flow">
    <h4 class="text-light mb-4">{{ flow.name }}</h4>

    <!-- Basket (always visible) -->
    <div class="card bg-dark border border-light text-light mb-4 basket-enter">
        <div class="card-body">
            <h5 class="card-title">
                üõí Your Basket
                <span *ngIf="basket.length > 0">({{ basket.length }})</span>
            </h5>

            <!-- Items -->
            <ul class="mb-2 ps-3" *ngIf="basket.length; else emptyBasket">
                <li *ngFor="let item of basket">{{ item }}</li>
            </ul>

            <!-- Empty state -->
            <ng-template #emptyBasket>
                <p class="fst-italic text-light small mb-2">Your basket is empty.</p>
            </ng-template>

            <div class="text-end">
                <button class="btn btn-sm btn-outline-light" [disabled]="!basket.length" (click)="basket = []">
                    Clear Basket
                </button>
            </div>
        </div>
    </div>


    <!-- Conversation flow -->
    <div *ngFor="let step of visibleSteps" class="mb-3">

        <!-- Message -->
        <div *ngIf="step.type === 'message'" class="border border-light rounded-4 px-4 py-2">
            {{ step.text }}
        </div>

        <!-- Wait -->
        <div *ngIf="step.type === 'wait'" class="text-secondary small text-center fst-italic">
            ‚è≥ Waiting {{ step.duration }}ms...
        </div>

        <!-- Card -->
        <div *ngIf="step.type === 'card'" class="card bg-dark text-light shadow-sm border-0 mb-3">
            <div class="card-body">
                <h5 class="card-title">{{ step.title }}</h5>
                <p *ngIf="step.description" class="card-text">{{ step.description }}</p>
                <div class="d-flex flex-wrap gap-2 mt-3">
                    <button *ngFor="let btn of step.buttons" class="btn btn-outline-light rounded-4"
                        (click)="onButtonClick(btn)">
                        {{ btn.label }}
                    </button>
                </div>
            </div>
        </div>

        <!-- Checkout -->
        <div *ngIf="step.type === 'checkout'" class="card bg-dark text-light border-info shadow-sm mb-3">
            <div class="card-body">
                <h5 class="card-title">{{ step.title }}</h5>
                <p *ngIf="step.description" class="card-text">{{ step.description }}</p>

                <ul class="small mb-3 ps-3" *ngIf="basket.length">
                    <li *ngFor="let item of basket">{{ item }}</li>
                </ul>

                <div class="d-flex flex-wrap gap-2 mt-3">
                    <button *ngFor="let btn of step.buttons" class="btn btn-info rounded-4"
                        (click)="onButtonClick(btn)">
                        {{ btn.label }}
                    </button>
                </div>
            </div>
        </div>

    </div>

    <div *ngIf="!running" class="text-center mt-4">
        <button class="btn btn-success" (click)="startFlow()">‚ñ∂Ô∏è Run Again</button>
    </div>

</div>